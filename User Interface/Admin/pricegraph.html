<html>

<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"></script>
 
</head>

<body>
    <div class="navbar"></div>
    <div class="wrapper">
        <div id="chart"></div>
        <script type="text/javascript">
      
            function getData() {
                // console.log(i);
                var dt=[];
                $.ajax({
            async: false,
            type: "POST",
            url: "pricegraph.php",
            success: function (response) {
              
                dt=(JSON.parse(response));

              }
            });
            return dt;
        }
        data=getData();
        
            var x0Values = [data[0].date + ("-") + data[0].time + "-00"];
            var x1Values = [data[1].date + ("-") + data[1].time + "-00"];
            var x2Values = [data[2].date + ("-") + data[2].time + "-00"];
            var x3Values = [data[3].date + ("-") + data[3].time + "-00"];
            var x4Values = [data[4].date + ("-") + data[4].time + "-00"];
            var x5Values = [data[5].date + ("-") + data[5].time + "-00"];
            var x6Values = [data[6].date + ("-") + data[6].time + "-00"];
            var x7Values = [data[7].date + ("-") + data[7].time + "-00"];
            var x8Values = [data[8].date + ("-") + data[8].time + "-00"];
            var x9Values = [data[9].date + ("-") + data[9].time + "-00"];
            var y0Values = [data[0].price];
            var y1Values = [data[1].price];
            var y2Values = [data[2].price];
            var y3Values = [data[3].price];
            var y4Values = [data[4].price];
            var y5Values = [data[5].price];
            var y6Values = [data[6].price];
            var y7Values = [data[7].price];
            var y8Values = [data[8].price];
            var y9Values = [data[9].price];


            var values = [
            {x: x0Values, y: y0Values, mode:"lines+markers",name:"Charging Station:1"},
            {x: x1Values, y: y1Values, mode:"lines+markers",name:"Charging Station:2"},
            {x: x2Values, y: y2Values, mode:"lines+markers",name:"Charging Station:3"},
            {x: x3Values, y: y3Values, mode:"lines+markers",name:"Charging Station:4"},
            {x: x4Values, y: y4Values, mode:"lines+markers",name:"Charging Station:5"},
            {x: x5Values, y: y5Values, mode:"lines+markers",name:"Charging Station:6"},
            {x: x6Values, y: y6Values, mode:"lines+markers",name:"Charging Station:7"},
            {x: x7Values, y: y7Values, mode:"lines+markers",name:"Charging Station:8"},
            {x: x8Values, y: y8Values, mode:"lines+markers",name:"Charging Station:9"},
            {x: x9Values, y: y9Values, mode:"lines+markers",name:"Charging Station:10"}
            ];
            var layout = {
            title: "Prices of All Charging Stations"
            };
            Plotly.plot('chart', values,layout);

            var cnt = 0;

            setInterval(function () {
                data=getData();
                console.log(data);
                x0Values.push(data[0].date + ("-") + data[0].time + "-00")
                x1Values.push(data[1].date + ("-") + data[1].time + "-00")
                x2Values.push(data[2].date + ("-") + data[2].time + "-00")
                x3Values.push(data[3].date + ("-") + data[3].time + "-00")
                x4Values.push(data[4].date + ("-") + data[4].time + "-00")
                x5Values.push(data[5].date + ("-") + data[5].time + "-00")
                x6Values.push(data[6].date + ("-") + data[6].time + "-00")
                x7Values.push(data[7].date + ("-") + data[7].time + "-00")
                x8Values.push(data[8].date + ("-") + data[8].time + "-00")
                x9Values.push(data[9].date + ("-") + data[9].time + "-00")
                y0Values.push(data[0].price)
                y1Values.push(data[1].price)
                y2Values.push(data[2].price)
                y3Values.push(data[3].price)
                y4Values.push(data[4].price)
                y5Values.push(data[5].price)
                y6Values.push(data[6].price)
                y7Values.push(data[7].price)
                y8Values.push(data[8].price)
                y9Values.push(data[9].price)
                Plotly.redraw('chart', values,layout);
                cnt++;
                if (cnt > 500) {
                    Plotly.relayout('chart', {
                        xaxis: {
                            range: [cnt - 500, cnt]
                        }
                    });
                }
            }, 3000);
            
        </script>
    </div>

</body>

</html>